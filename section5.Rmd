---
title: "section5.Rmd"
output: html_document
date: "2022-12-09"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
`
# 統計的仮説検定
- 研究者が自分主張が正しいことを証明するためには本来母集団すべてのデータを集めるしかないが、それは実際無理
- 無理なので、主張の反論が起きることは現実的にほとんどありえないと示すことで、主張の確からしさを確認できる
  - これは完全に反論を否定できない点でやや説得力は弱い方法になるが、限られた標本データからの合理性を持った主張としては強力である

## 統計的仮説検証の手順と用語
- μ
  - 期待値もしくは平均値
  - 分布の中心値のこと
- σ
  - 標準偏差
- 実現値
  - ある時点が過ぎて定まる値のこと
    - 既に実現した値のこと
  - e.g.
    - サイコロを振ったときに出た目
    - 採点が終わった後にわかったある生徒のテストの点数
- 両側検定
  - 母平均 ≠ 0とか
- 片側検定
  - 母平均 > 0とか
- 自分の主張に対する反論、つまり差がないとか効果がないと言うような仮設を帰無仮説として定義する
- この帰無仮説が棄却されたときに採択されるのが、対立仮説(自分の主張)
- 帰無仮説を棄却して、対立仮説を採択するか決めるときにどの程度の確率が得られたら帰無仮説を棄却するかという基準値を優位水準という
  - 大体優位水準は5%
  - 検定統計量が棄却域(5%以下)に入ったら、差がない/効果がないという帰無仮説を棄却して、差があるという対立仮説を採択する
- p値
  - 帰無仮説が正しいという仮設のもとで、標本から計算した検定統計量の実現値以上の値が得られる確率
  - p値が有意水準より小さいときに帰無仮説を棄却する
- 第一種の誤り
  - 帰無仮説が真のとき、これを棄却してしまう
- 第二種の誤り
  - 帰無仮説が偽のとき、これを採択する (棄却できない)
- 帰無仮説を棄却できない場合、有意差がないという
  - >「有意差がない」ということは、実験や調査で得られた条件間の差は偶然でも（つまり標本抽出による誤差によっても）十分起こり得る程度の差ですよ、という意味に過ぎません。「有意差がない」というのは、「統計的に意味のある差ではない」ということです。つまり、有意差が見られなかったとしても、そのことからすぐに「同じである」ということにはならないのです。


## 標準正規分布を使った検定
過去のデータの蓄積から心理学テストの得点は平均12, 分散10の正規分布に従うが、下記標本はこの母集団の無造作標本と考えてよいか

```{r}
心理学テスト <- c(13, 14, 7, 12, 10, 6, 8, 15, 4, 14, 9, 6, 10, 12, 5, 12, 8, 8, 12, 15)
心理学テスト
```


- 帰無仮説
  - 心理学テストの母平均は12である
- 対立仮説
  - 心理学テストの母平均は12でない
  
```{r}
Z分子 <- mean(心理学テスト) - 12
Z分子

Z分母 <- sqrt(10 / length(心理学テスト))
Z分母

Zスコア <- Z分子 / Z分母
Zスコア
```

```{r}
qnorm(0.025)
qnorm(0.975)
```

```{r}
curve(dnorm(x), -3, 3)
abline(v = qnorm(0.025))
abline(v = qnorm(0.975))
```

棄却域は Z < `-1.959964` or `Z  > 1.959964` になる

```{r}
pnorm(Zスコア) # 下側確率
pnorm(abs(Zスコア), lower.tail = FALSE) # 上側確率
```

```{r}
# 単純に二倍して、p血を計算する
2 * pnorm(abs(Zスコア), lower.tail = FALSE)
```

- pnormを使って直接p値を求めることも可能
  - Zスコアを与えて上げるとp値が出る
  - 上側の確率を求めるときは lower.tail = FALSE を渡す
- p値が有意水準よりも小さければ、差がないケースがかなり少ないと判断できて、帰無仮説は棄却される

## t分布を用いた検定

- 母集団の分散がわからないケースの、無造作標本を仮説検定したいケースでは、標準正規分布を使うことができない
  - 母集団の分散がわからないと、Zスコアを計算することができないため
- 代わりに規表現によく似たt分布を使って検定することができる
　- 母集団の分散の代わりに、不偏分散の正の平方根を使って計算するけんてい統計量を使う
  - 自由度は正直理解できてないが、グラフ山の高さは自由度によって決まる
    - 自由度は n - 1
  
```{r}
t分子 <- mean(心理学テスト) - 12
t分子

t分母 <- sqrt(var(心理学テスト) / length(心理学テスト)) # varで不偏分散が出る
t分母

t統計量 <- t分子 / t分母
t統計量
```

- ここまでで検定統計量の実現地がわかる

```{r}
# t分布での棄却域を計算
qt(0.025, 19) # 自由度19のt分布で下側確率0.025となるtの確率を求める
qt(0.975, 19) # 自由度19のt分布で上側確率0.975となるtの確率を求める
```

- 棄却域は t < `-2.093024` or `t  > 2.093024` になり、検定統計量の実現地値は-2.616648なので、帰無仮説は棄却される
- 標準正規分布を使ったときと同様に、pt関数を使えばp値を求めて計算することも可能
- なお、以下のようにt.test関数で一発でt検定することもできる！(すごい)

```{r}
t.test(心理学テスト, mu = 12) # muは母平均μ=12という意味。これ省略すると母平均 μ=0として検定されちゃう
```

- p-value = 0.01697となっているので、p値が0.05より小さいことがわかり、帰無仮説が棄却できることがわかる


## 相関係数の検定 (無相関検定)
- 帰無仮説を、「母集団において相関が0である」と設定するので、無相関検定とも呼ばれる
- p値が0.05よりも小さければ帰無仮説が棄却されて、相関があるという話になる
- `cor.test` 関数使えば実行できる
  - デフォルトピアソンのピアソンの積率相関係数が使われるがmethodパラメータで別の方法での相関係数検定を行える
  - > alternative hypothesis: true correlation is not equal to 0」とは、対立仮説が「ρ ≠ 0」であることを示しています。これより両側検定であることが分かります。
  - >「95 percent confidence interval：0.4596086 0.8952048」では、95％信頼区間の下限と上限の値が示されています。信頼区間の信頼係数は変更することが可能です。90％信頼区間を求めたいのであれば、conf.level＝0.9とオプションをつけてください。
  - > 最後の「sample estimates:」では標本から計算された標本相関係数の実現値が示されています。

## 独立性の検定 (カイ二乗検定)

- 独立性
  - ２つの質的変数が独立であるか (２つの質的変数に関連がないこと)
- 独立性の検定として、カイ二乗分布を利用したカイ二乗検定がある
  - 観測度数(クロス集計表上の数値)と期待度数(２変数間に関連がないという帰無仮説のもとで、帰無仮説がただしければこれくらいの値を取るだろうという度数)のズレを評価する感じ
  - 期待度数(クロス集計表の計にかかれている数値)は周辺度数から計算できる
    - 期待度数 = セルが属する行の周辺度数 × セルが属する列の周辺度数
- 優位水準より小さい結果になったら帰無仮説が棄却されて関連があるということになる
    
```{r}
数学 <- c("嫌い", "嫌い", "好き", "好き", "嫌い", "嫌い", "嫌い", "嫌い", "嫌い", "好き", "好き", "嫌い", "好き", "嫌い", "嫌い", "好き", "嫌い", "嫌い", "嫌い", "嫌い")
統計 <- c("好き", "好き", "好き", "好き", "嫌い", "嫌い", "嫌い", "嫌い", "嫌い", "嫌い", "好き", "好き", "好き", "嫌い", "好き", "嫌い", "嫌い", "嫌い", "嫌い", "嫌い")
クロス集計表 <- table(数学, 統計)

chisq.test(クロス集計表, correct = FALSE)
```

## 練習問題

### (1)
```{r}
身長 <- c(165, 150, 170, 168, 159, 170, 167, 178, 155, 159, 161, 162, 166, 171, 155, 160, 168, 172, 155, 167)
t.test(身長, mu = 170)
```

- 集合はこの国の母集団からの無造作標本と考えて良いか？
- 帰無仮説
  - 無造作標本である
- 対立仮設
  - 無造作標本でない
- 優位水準
  - 5%
- p-value
  - 0.001
- 帰無仮説は棄却されてるので、無造作標本ではないと考えられる

### (2)
```{r}
勉強時間 <- c(1, 3, 10, 12, 6, 3, 8, 4, 1, 5)
得点 <- c(20, 40, 100, 80, 50, 50, 70, 50, 10, 60)
cor.test(勉強時間, 得点)
```

### (3)
```{r}
cor.test(勉強時間, 得点, method = "spearman")
cor.test(勉強時間, 得点, method = "kendall")
```

### (4)
```{r}
食事タイプ <- c("洋食", "和食", "和食", "洋食", "和食", "洋食", "洋食", "和食", "洋食", "洋食", "和食", "洋食", "和食", "洋食", "和食", "和食", "洋食", "洋食", "和食", "和食")
味覚 <- c("甘党", "辛党", "甘党", "甘党", "辛党", "辛党", "辛党", "辛党", "甘党", "甘党", "甘党", "甘党", "辛党", "辛党", "甘党", "辛党", "辛党", "甘党", "辛党", "辛党")
食事クロス集計表 <- table(食事タイプ, 味覚)
chisq.test(食事クロス集計表, correct = FALSE)
```

### (5-1)
```{r}
国語 <- c(60, 40, 30, 70, 55)
社会 <- c(80, 25, 35, 70, 50)
cor.test(国語, 社会)
```

### (5-2)
```{r}
国語 <- c(60, 40, 30, 70, 55)
国語2 <- rep(国語, 2)
社会 <- c(80, 25, 35, 70, 50)
社会2 <- rep(社会, 2)
cor.test(国語2, 社会2)
```